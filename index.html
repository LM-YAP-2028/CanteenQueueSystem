<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <title>Canteen Registration Queuing System</title>
</head>
<body>
  <h1>Canteen Registration Queuing System</h1>
  <hr>

  <input type="text" id="name" placeholder="Enter name" required>
  <input type="text" id="purpose" placeholder="Enter your purpose of visit" required>
  <input type="number" id="sID" placeholder="Enter your student ID" required>
  <button onclick="addToQueue()">Add to Queue</button>

  <hr>
  <h3>Queue:</h3>
  <p id="queueDisplay"></p>
  <hr>

  <h2>Admin Panel</h2>
  <h4>Serving:</h4>
  <p id="serving">No one is currently being served.</p>
  <button onclick="removeFromQueue()">Served</button>

  <hr>
  <h2>Check Your Position in Queue</h2>
  <input type="number" id="checkID" placeholder="Enter your student ID">
  <button onclick="checkPositionByID()">Check Position</button>
  <p id="positionResult"></p>

  <script>
    var queue = [];

    // Load queue from localStorage
    var saved = localStorage.getItem("queue");
    if (saved) {
      queue = saved.split("|").filter(function (entry) {
        return entry.trim() !== "";
      });
    }

    function setCookie(name, value) {
      document.cookie = encodeURIComponent(name) + "=" + encodeURIComponent(value) + "; path=/";
    }

    function getAllCookies() {
      var cookies = {};
      var decoded = decodeURIComponent(document.cookie).split("; ");
      for (var i = 0; i < decoded.length; i++) {
        var parts = decoded[i].split("=");
        cookies[parts[0]] = parts[1];
      }
      return cookies;
    }

    function deleteCookie(name) {
      document.cookie = encodeURIComponent(name) + "=; expires=Thu, 01 Jan 1970 00:00:00 UTC; path=/;";
    }

    function updateDisplay() {
      var display = "";

      for (var i = 0; i < queue.length; i++) {
        display += (i + 1) + ". " + queue[i] + "<br>";
      }

      if (queue.length === 0) {
        display = "Queue is empty.";
      }

      document.getElementById("queueDisplay").innerHTML = display;
      if (queue.length > 0) {
        document.getElementById("serving").innerHTML = queue[0];
      } else {
        document.getElementById("serving").innerHTML = "No one is currently being served.";
      }


      localStorage.setItem("queue", queue.join("|"));
    }

    function addToQueue() {
      var name = document.getElementById("name").value;
      var purpose = document.getElementById("purpose").value;
      var sID = document.getElementById("sID").value;

      if (name === "" || purpose === "" || sID === "") {
        alert("Please fill in all fields.");
        return;
      }

      for (var i = 0; i < queue.length; i++) {
        if (queue[i].endsWith(" - " + sID)) {
          alert("You are already in the queue.");
          return;
        }
      }

      var entry = name + " - " + purpose + " - " + sID;
      queue.push(entry);
      setCookie("entry_" + sID, entry);
      updateDisplay();

      document.getElementById("name").value = "";
      document.getElementById("purpose").value = "";
      document.getElementById("sID").value = "";
    }

    function removeFromQueue() {
      if (queue.length > 0) {
        var removed = queue.shift();

        var parts = removed.split(" - ");
        if (parts.length === 3) {
          var removedID = parts[2].trim();
          deleteCookie("entry_" + removedID);
        }

        updateDisplay();
      }
    }

    function checkPositionByID() {
      var inputID = document.getElementById("checkID").value;

      if (inputID === "") {
        document.getElementById("positionResult").innerHTML = "Please enter a student ID.";
        return;
      }

      var cookies = getAllCookies();
      var entry = cookies["entry_" + inputID];

      if (!entry) {
        document.getElementById("positionResult").innerHTML = "No entry found for this ID.";
        return;
      }

      var index = queue.indexOf(entry);
      if (index >= 0) {
        document.getElementById("positionResult").innerHTML = "Student ID " + inputID + " is at position " + (index + 1) + " in the queue.";
      } else {
        document.getElementById("positionResult").innerHTML = "Student ID " + inputID + " is not currently in the queue.";
      }
    }

    window.onload = function () {
      updateDisplay();
    };
  </script>
</body>
</html>
